<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fun Facts</title>
  <style>
    :root{
      --bg: #0b0f19;
      --card: rgba(255,255,255,.06);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.72);
      --border: rgba(255,255,255,.12);
      --accent: #7aa7ff;
      --accent2: #7dffa7;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    [data-theme="light"]{
      --bg: #f6f8ff;
      --card: rgba(10,18,40,.06);
      --text: #0b0f19;
      --muted: rgba(11,15,25,.7);
      --border: rgba(10,18,40,.14);
      --accent: #2c66ff;
      --accent2: #00a86b;
      --shadow: 0 14px 30px rgba(10,18,40,.12);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background: radial-gradient(900px 500px at 20% 10%, rgba(122,167,255,.18), transparent 60%),
                  radial-gradient(800px 500px at 80% 40%, rgba(125,255,167,.12), transparent 60%),
                  var(--bg);
      min-height:100svh;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 14px 38px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 14px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .2px;
      line-height:1.1;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height:1.4;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight: 600;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.08); }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.small{ padding: 8px 10px; font-weight: 650; box-shadow:none; }

    .pill{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
      display:inline-flex;
      gap:6px;
      align-items:center;
    }

    .toolbar{
      display:grid;
      gap: 10px;
      grid-template-columns: 1fr;
      margin: 14px 0 14px;
    }
    @media (min-width: 720px){
      .toolbar{
        grid-template-columns: 1.25fr .55fr .55fr;
        align-items:stretch;
      }
    }

    .field{
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
    }
    .field input, .field select{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }
    .field select{
      appearance:none;
      cursor:pointer;
    }
    .field .icon{
      color: var(--muted);
      font-size: 15px;
      min-width: 18px;
      text-align:center;
    }

    .grid{
      display:grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 560px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }

    .card{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius: var(--radius);
      padding: 14px 14px 12px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    [data-theme="light"] .card{
      background: linear-gradient(180deg, rgba(10,18,40,.06), rgba(10,18,40,.03));
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-40px -40px auto auto;
      width: 140px;
      height: 140px;
      background: radial-gradient(circle at 30% 30%, rgba(122,167,255,.35), transparent 55%);
      transform: rotate(10deg);
      pointer-events:none;
    }

    .cardTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .cat{
      font-size: 12px;
      color: var(--muted);
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      padding: 6px 10px;
      border-radius: 999px;
      max-width: 100%;
    }

    .fact{
      margin: 0;
      font-size: 15px;
      line-height: 1.45;
      letter-spacing: .1px;
    }

    .cardFooter{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top: 12px;
    }

    .meta{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    .star{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      width: 40px;
      height: 36px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease;
    }
    .star:hover{ background: rgba(255,255,255,.08); }
    .star:active{ transform: translateY(1px); }
    .star.active{
      border-color: rgba(122,167,255,.55);
      background: rgba(122,167,255,.14);
    }

    .empty{
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      padding: 18px;
      color: var(--muted);
      text-align:center;
      background: rgba(255,255,255,.03);
    }

    /* Modal */
    .backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 50;
    }
    .backdrop.show{ display:flex; }

    .modal{
      width: min(620px, 100%);
      border: 1px solid var(--border);
      border-radius: 20px;
      background: var(--bg);
      box-shadow: 0 22px 60px rgba(0,0,0,.5);
      padding: 14px;
    }
    [data-theme="light"] .modal{ background: #ffffff; }

    .modalHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .modalHeader h2{
      margin:0;
      font-size: 18px;
    }

    .modalGrid{
      display:grid;
      gap:10px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 720px){
      .modalGrid{ grid-template-columns: 1fr .55fr; }
    }

    .modal .input{
      border:1px solid var(--border);
      background: var(--card);
      border-radius: 14px;
      padding: 10px 12px;
      color: var(--text);
      outline:0;
      width:100%;
      font-size: 14px;
    }
    .modal textarea.input{
      min-height: 92px;
      resize: vertical;
    }

    footer{
      margin-top: 18px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    a{ color: var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Fun Facts ‚ö°</h1>
        <p class="sub">Des infos courtes, surprenantes, faciles √† retenir. Recherche, cat√©gories, random et favoris.</p>
      </div>

      <div class="actions">
        <span class="pill" id="countPill">0 facts</span>
        <button class="btn small" id="randomBtn" title="Choisir un fun fact au hasard">üé≤ Random</button>
        <button class="btn small" id="addBtn" title="Ajouter un fun fact">‚ûï Ajouter</button>
        <button class="btn small" id="themeBtn" title="Changer de th√®me">üåô</button>
      </div>
    </header>

    <section class="toolbar">
      <div class="field" title="Rechercher">
        <span class="icon">üîé</span>
        <input id="search" placeholder="Rechercher un mot (ex: v√©nus, cerveau, Japon‚Ä¶)" autocomplete="off" />
      </div>

      <div class="field" title="Filtrer par cat√©gorie">
        <span class="icon">üè∑Ô∏è</span>
        <select id="category"></select>
      </div>

      <button class="btn" id="showFavBtn" title="Afficher uniquement les favoris">‚≠ê Favoris</button>
    </section>

    <main class="grid" id="grid"></main>

    <footer>
      <div>üíæ Favoris & ajouts enregistr√©s dans ton navigateur (localStorage).</div>
      <div>Astuce : ajoute ce site en favoris sur mobile pour l‚Äôavoir comme une mini-app.</div>
    </footer>
  </div>

  <!-- Modal Ajout -->
  <div class="backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <h2 id="modalTitle">Ajouter un fun fact</h2>
        <button class="btn small" id="closeModal">‚úñ</button>
      </div>

      <div class="modalGrid">
        <div>
          <label style="display:block; margin:6px 0 6px; color: var(--muted); font-size:12px;">Texte</label>
          <textarea class="input" id="newText" placeholder="Ex: Les pieuvres ont trois c≈ìurs‚Ä¶" maxlength="220"></textarea>
          <div style="margin-top:6px; color: var(--muted); font-size:12px;" id="charCount">0/220</div>
        </div>

        <div>
          <label style="display:block; margin:6px 0 6px; color: var(--muted); font-size:12px;">Cat√©gorie</label>
          <select class="input" id="newCat"></select>

          <div style="height:10px"></div>

          <button class="btn" id="saveFact">‚úÖ Enregistrer</button>
          <div style="height:8px"></div>
          <button class="btn" id="resetCustom" title="Supprime les facts ajout√©s √† la main">üßπ Effacer mes ajouts</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---- Donn√©es de base ----
    const DEFAULT_FACTS = [
      { id: "d1", cat: "Culture", text: "Dans beaucoup de pays, le dimanche est consid√©r√© comme le premier jour de la semaine." },
      { id: "d2", cat: "Animaux", text: "Les kangourous ne peuvent pas reculer (forme du bassin + grande queue pour l‚Äô√©quilibre)." },
      { id: "d3", cat: "Science", text: "Ton cerveau ne ressent pas la douleur (il n‚Äôa pas de r√©cepteurs de douleur)." },
      { id: "d4", cat: "Espace", text: "Une journ√©e sur V√©nus est plus longue qu‚Äôune ann√©e sur V√©nus." },
      { id: "d5", cat: "Animaux", text: "Les pieuvres ont trois c≈ìurs et leur sang est bleu." },
      { id: "d6", cat: "Quotidien", text: "Les bananes sont l√©g√®rement radioactives √† cause du potassium." },
      { id: "d7", cat: "Corps", text: "Tu es un peu plus grand le matin que le soir (la colonne vert√©brale se tasse)." },
      { id: "d8", cat: "Histoire", text: "Les requins existaient avant les arbres." },
      { id: "d9", cat: "Culture", text: "Au Japon, s‚Äôendormir au travail peut √™tre vu comme un signe de d√©vouement (selon le contexte)." },
      { id: "d10", cat: "Quotidien", text: "Un stylo bille peut √©crire environ 2 km de ligne (selon le mod√®le et l‚Äôusage)." },
      { id: "d11", cat: "Espace", text: "Si le Soleil disparaissait, on ne s‚Äôen rendrait compte qu‚Äôenviron 8 minutes plus tard." },
      { id: "d12", cat: "Corps", text: "La paroi de ton estomac se renouvelle en quelques jours pour √©viter de se dig√©rer." },
    ];

    const CATEGORIES = ["Toutes", "Culture", "Science", "Espace", "Animaux", "Corps", "Quotidien", "Histoire"];

    // ---- Stockage ----
    const LS = {
      theme: "funfacts_theme",
      favs: "funfacts_favs",
      custom: "funfacts_custom"
    };

    function loadJSON(key, fallback) {
      try {
        const v = localStorage.getItem(key);
        return v ? JSON.parse(v) : fallback;
      } catch { return fallback; }
    }
    function saveJSON(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    // ---- State ----
    let onlyFavs = false;
    let favs = new Set(loadJSON(LS.favs, []));
    let customFacts = loadJSON(LS.custom, []);
    let facts = [...DEFAULT_FACTS, ...customFacts];

    // ---- Elements ----
    const grid = document.getElementById("grid");
    const searchEl = document.getElementById("search");
    const catEl = document.getElementById("category");
    const newCatEl = document.getElementById("newCat");
    const showFavBtn = document.getElementById("showFavBtn");
    const randomBtn = document.getElementById("randomBtn");
    const themeBtn = document.getElementById("themeBtn");
    const countPill = document.getElementById("countPill");

    // Modal
    const backdrop = document.getElementById("backdrop");
    const closeModalBtn = document.getElementById("closeModal");
    const addBtn = document.getElementById("addBtn");
    const saveFactBtn = document.getElementById("saveFact");
    const resetCustomBtn = document.getElementById("resetCustom");
    const newTextEl = document.getElementById("newText");
    const charCount = document.getElementById("charCount");

    // ---- Theme init ----
    const savedTheme = localStorage.getItem(LS.theme) || "dark";
    document.documentElement.setAttribute("data-theme", savedTheme);
    themeBtn.textContent = savedTheme === "dark" ? "üåô" : "‚òÄÔ∏è";

    function setTheme(next) {
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem(LS.theme, next);
      themeBtn.textContent = next === "dark" ? "üåô" : "‚òÄÔ∏è";
    }

    // ---- Category options ----
    function fillSelect(select, categories) {
      select.innerHTML = "";
      categories.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        select.appendChild(opt);
      });
    }
    fillSelect(catEl, CATEGORIES);
    fillSelect(newCatEl, CATEGORIES.filter(c => c !== "Toutes"));
    catEl.value = "Toutes";
    newCatEl.value = "Culture";

    // ---- Filtering ----
    function getFilteredFacts() {
      const q = searchEl.value.trim().toLowerCase();
      const cat = catEl.value;

      return facts.filter(f => {
        const matchesQ = !q || (f.text.toLowerCase().includes(q) || f.cat.toLowerCase().includes(q));
        const matchesCat = (cat === "Toutes") || f.cat === cat;
        const matchesFav = !onlyFavs || favs.has(f.id);
        return matchesQ && matchesCat && matchesFav;
      });
    }

    // ---- Render ----
    function render() {
      const list = getFilteredFacts();
      countPill.textContent = `${list.length} fact${list.length > 1 ? "s" : ""}`;

      grid.innerHTML = "";

      if (list.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.innerHTML = `
          <div style="font-size:16px; margin-bottom:6px;">Aucun r√©sultat üòÖ</div>
          <div>Essaie une autre recherche ou enl√®ve les filtres.</div>
        `;
        grid.appendChild(empty);
        return;
      }

      list.forEach(f => {
        const card = document.createElement("article");
        card.className = "card";

        const isFav = favs.has(f.id);

        card.innerHTML = `
          <div class="cardTop">
            <div class="cat">üè∑Ô∏è <span>${escapeHTML(f.cat)}</span></div>
            <button class="star ${isFav ? "active" : ""}" aria-label="Favori" title="Favori">
              ${isFav ? "‚≠ê" : "‚òÜ"}
            </button>
          </div>

          <p class="fact">${escapeHTML(f.text)}</p>

          <div class="cardFooter">
            <div class="meta">
              <span>üÜî ${escapeHTML(f.id)}</span>
              ${f.id.startsWith("c_") ? `<span>üìù ajout√©</span>` : `<span>üìö base</span>`}
            </div>
            <button class="btn small" title="Copier ce fun fact">üìã Copier</button>
          </div>
        `;

        const starBtn = card.querySelector(".star");
        starBtn.addEventListener("click", () => {
          if (favs.has(f.id)) favs.delete(f.id);
          else favs.add(f.id);
          saveJSON(LS.favs, [...favs]);
          render();
        });

        const copyBtn = card.querySelector(".btn.small");
        copyBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(f.text);
            copyBtn.textContent = "‚úÖ Copi√©";
            setTimeout(() => (copyBtn.textContent = "üìã Copier"), 900);
          } catch {
            alert("Impossible de copier automatiquement. S√©lectionne le texte manuellement üôè");
          }
        });

        grid.appendChild(card);
      });
    }

    function escapeHTML(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ---- Events ----
    searchEl.addEventListener("input", render);
    catEl.addEventListener("change", render);

    showFavBtn.addEventListener("click", () => {
      onlyFavs = !onlyFavs;
      showFavBtn.textContent = onlyFavs ? "‚≠ê Favoris (ON)" : "‚≠ê Favoris";
      showFavBtn.style.borderColor = onlyFavs ? "rgba(122,167,255,.55)" : "";
      showFavBtn.style.background = onlyFavs ? "rgba(122,167,255,.14)" : "";
      render();
    });

    randomBtn.addEventListener("click", () => {
      const list = getFilteredFacts();
      if (!list.length) return;

      const pick = list[Math.floor(Math.random() * list.length)];
      // Met le texte dans la recherche pour le retrouver rapidement
      searchEl.value = "";
      catEl.value = "Toutes";
      onlyFavs = false;
      showFavBtn.textContent = "‚≠ê Favoris";
      showFavBtn.style.borderColor = "";
      showFavBtn.style.background = "";

      render();
      // Petit highlight via scroll + focus visuel (on retrouve la carte via l'id affich√©)
      setTimeout(() => {
        const card = [...document.querySelectorAll(".card")].find(el => el.textContent.includes(`üÜî ${pick.id}`));
        if (card) {
          card.scrollIntoView({ behavior: "smooth", block: "center" });
          card.animate([{ transform: "scale(1)" }, { transform: "scale(1.02)" }, { transform: "scale(1)" }], { duration: 520 });
        }
      }, 50);
    });

    themeBtn.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") || "dark";
      setTheme(current === "dark" ? "light" : "dark");
    });

    // ---- Modal logic ----
    function openModal() {
      backdrop.classList.add("show");
      backdrop.setAttribute("aria-hidden", "false");
      newTextEl.value = "";
      charCount.textContent = "0/220";
      newTextEl.focus();
    }
    function closeModal() {
      backdrop.classList.remove("show");
      backdrop.setAttribute("aria-hidden", "true");
    }

    addBtn.addEventListener("click", openModal);
    closeModalBtn.addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e) => { if (e.target === backdrop) closeModal(); });
    window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

    newTextEl.addEventListener("input", () => {
      charCount.textContent = `${newTextEl.value.length}/220`;
    });

    saveFactBtn.addEventListener("click", () => {
      const text = newTextEl.value.trim();
      const cat = newCatEl.value;

      if (!text || text.length < 8) {
        alert("Ajoute un texte un peu plus long üôÇ");
        return;
      }

      const id = `c_${Date.now().toString(36)}`;
      const fact = { id, cat, text };

      customFacts.unshift(fact);
      saveJSON(LS.custom, customFacts);

      facts = [...DEFAULT_FACTS, ...customFacts];
      closeModal();
      render();
    });

    resetCustomBtn.addEventListener("click", () => {
      if (!confirm("Supprimer tous tes fun facts ajout√©s ?")) return;
      customFacts = [];
      saveJSON(LS.custom, []);
      facts = [...DEFAULT_FACTS];
      closeModal();
      render();
    });

    // ---- Initial render ----
    render();
  </script>
</body>
</html>
